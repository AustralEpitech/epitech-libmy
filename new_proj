#!/bin/bash

SRC=$(dirname $0)/

get_answer () {
    case $1 in
        "" | [Yy] | [Yy][Ee][Ss])
            ANSWER="Y";;
        [Nn] | [Nn][Oo])
            ANSWER="N";;
        *)
            ANSWER="";;
    esac
}

NAME=$1

while [ -z $NAME ]; do
    if ! read -p "Name: " NAME; then echo; fi
done

DIR=$SRC../$NAME

FLAGS="-rp"

if [ -d $DIR ]; then
    while [ -z $ANSWER ]; do
        read -r -p "$NAME exists. Replace files? [Y/n] " ANSWER
        get_answer $ANSWER
        if [[ $ANSWER == "N" ]]; then
            FLAGS+="n"
        fi
    done
fi

cp $FLAGS $SRC/repo/. $DIR
rename %%PROJ%% $NAME $DIR/**/*

find $DIR -type "f" -exec sed -i "s/%%PROJ%%/$NAME/g; s/%%PROJ_UP%%/${NAME^^}/g" "{}" +

echo "DONE"